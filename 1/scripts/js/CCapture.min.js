(function(){function d(){}function h(a){a.quality=a.quality/100||0.8;this.settings=a;this.encoder=new Whammy.Video(a.framerate,a.quality)}function i(a){a.quality=31-(30*a.quality/100||10);a.workers=a.workers||4;this.settings=a;this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d");this.sizeSet=!1;this.encoder=new GIF({workers:a.workers,quality:a.quality,workerScript:a.workersPath+"gif.worker.js"})}d.start=function(){};d.stop=function(){};d.add=function(){};d.save=function(){};
h.prototype=Object.create(d);h.prototype.add=function(a){this.encoder.add(a)};h.prototype.save=function(a){var b=this.encoder.compile(),b=new Blob([b],{type:"octet/stream"}),b=window.URL.createObjectURL(b);a(b)};i.prototype=Object.create(d);i.prototype.add=function(a){this.sizeSet||(this.encoder.setOption("width",a.width),this.encoder.setOption("height",a.height),this.sizeSet=!0);this.canvas.width=a.width;this.canvas.height=a.height;this.ctx.drawImage(a,0,0);this.encoder.addFrame(this.ctx,{copy:!0,
delay:this.settings.step})};i.prototype.save=function(a){this.encoder.on("finished",function(b){a(URL.createObjectURL(b))});if(this.settings.onProgress)this.encoder.on("progress",this.settings.onProgress);this.encoder.render()};window.CCapture=function(a){function b(){g("Capturer start");f=Date.now();Date.prototype.getTime=function(){return f};Date.now=function(){return f};setTimeout=function(a,c){var b={callback:a,time:c,triggerTime:f+c};e.push(b);g("Timeout set to "+b.time);return b};clearTimeout=
function(a){for(var b=0;b<e.length;b++)e[b]==a&&(e.splice(b,1),g("Timeout cleared"))};requestAnimationFrame=function(a){j=a}}function d(){f+=c.step;l++;g("Frame: "+l);for(var a=0;a<e.length;a++)f>=e[a].triggerTime&&(e[a].callback(),console.log("timeout!"),e.splice(a,1));j&&j()}function g(a){m&&console.log(a)}var c=a||{},m,f,e=[],l=0,j=null,k=!1;c.framerate=c.framerate||60;m=c.verbose||!1;c.step=1E3/c.framerate;g("Step is set to "+c.step+"ms");switch(c.format){case "gif":_encoder=new i(c);break;case "webm":_encoder=
new h(c);break;default:throw"Error: Format not specified (gif or webm)";}var o=setTimeout,p=clearTimeout,n=requestAnimationFrame,q=Date.now,r=Date.prototype.getTime;return{start:function(){b();_encoder.start();k=!0},capture:function(a){k&&(_encoder.add(a),n(d))},stop:function(){k=!1;_encoder.stop();g("Capturer stop");setTimeout=o;clearTimeout=p;requestAnimationFrame=n;Date.prototype.getTime=r;Date.now=q},save:function(a){_encoder.save(a)}}}})();
